# Philosophers
## Mandatory:
### Makefile:
Не забываем проверить *-lpthread*
### Input:
1. Без аргументов
2. С неправильным кол-во аргументов !=4 && != 5
3. C неправильным аргументом ( <0, =0, буквы, >MAX_INT) </br>
1-3 пишем ошибку
```
./philo
./philo 3 400
./philo 3g 410 200 200
./philo 5 410 200 -200
./philo 100 910 200 12345678981
./philo 0 910 200 400
``` 
4. С кол-вом *number_must_eat* = 0 `./philo 3 1070 400 200 0` </br>
Либо завершаем симуляцию сразу, либо пишем ошибку (почему именно так?)
5. С одним философом `./philo 1 1000 200 200` </br>
Философ возьмет или не возьмет вилку и умрет через `1000`
6. С двумя философами `./philo 2 810 400 200` </br>
Все должны жить
6. С тремя философами `./philo 3 810 400 200` </br>
Один умрет на `810`
6. С тремя философами `./philo 4 810 400 200 4` </br>
Каждый поест как минимум `4` раза
6. С кучей философами `./philo 123 1010 200 200` </br>
Все должны жить
6. С кучей философами `./philo 123 1010 200 200 3` </br>
Все должны жить. По хорошему, всего должны поесть `369` раз

P.S Большие объемы лучше направлять в >outfile, или grep необходимое

### Workability:
#### Init

Проверяем все выделение памяти, все *malloc* должны быть защищены, иначе выйти </br>
Если не создался *mutex*
```
if pthread_mutex_init(&mutex, 0)
```
выйти из программы

Если не создался поток
```
if (pthread_create(&thread, 0, start_thread, (void *)))
```
выйти из программы


Проверить кол-во приемов пищи:

```
./philo 101 1000 200 200 4 | grep eating | wc -l
```

### Leaks:
#### General
1. Очитка выделенной памяти (не забываем проверить все варианты ввода)
2. Закрытие всех *threads* </br>
`phread_join(thread, NULL);`
3. Уничтожение всех используемых *mutex* </br>
`pthread_mutex_destroy(mutex);`

#### -fsanitize=thread
Проверить: </br>
1. Один философ -> умирает
2. Несколько философов, все поели
3. Несколько филисофов, кто-то умирает

Не должно быть data races.

#### valgrind
1. Не должно быть dead lock'ов

P.S. Valgrind и fsanitize негативно влияют на работоспособность, время собятия может кардинально различаться.
___
## Bonus:
### Input:
Same as Mandatory

### Workability:

При завершении работы одного процесса(кто-то умер / все поели) нужно убить других философов(процессы) </br>
`kill(philos[i], SIGTERM);`

### Leaks:
#### General
1. Закрыть все используемые семафоры </br>
`sem_close(sem);`
2. Удалить именнованный семафор </br>
`sem_unlink("sem");`

#### -fsanitize=thread
Может некорректно работать с семафорами, если показывает data race, не значит, что все плохо. Придется проверять самим, каждое использование переменной. Если защищенно, то ОК.
